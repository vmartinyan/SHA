<?php // add new user subscription via wp mail setting ONif(isset($_POST['submit_subscriber'])) {	global $wpdb;	$table_name = $table_name = $wpdb->prefix . "rcsm_subscribers";	$f_name = $_POST['f_name'];	$l_name = $_POST['l_name'];	$visitor_email = sanitize_text_field($_POST['subscribe_email']);   // $nonce = $_POST['subscriber_nonce_field'];	$email_check =$wpdb->get_results( "SELECT * FROM $table_name WHERE email = '$visitor_email'" );	$num_email = $wpdb->num_rows;	if($email_check)  {	   $_SESSION['subscribe_msg'] = $wl_rcsm_options['sub_form_subscribe_invalid_message'];	} else {		if($wl_rcsm_options['confirm_email_subscribe'] == 'on'){			$visitor_email = $_POST['subscribe_email'];			$f_name = $_POST['f_name'];			$l_name = $_POST['l_name'];												$current_time = current_time( 'Y-m-d h:i:s' );			$act_code = rand(0,10000); // md5(date("d-m-y h:i:s"));			$adminemail = $wl_rcsm_options['wp_mail_email_id'];						 			$plugin_url = site_url();             			//$headers = array('From: '.$adminemail);			$headers = 'Content-type: text/html'."\r\n"."From:$plugin_url <$adminemail>"."\r\n".'Reply-To: '.$adminemail . "\r\n".'X-Mailer: PHP/' . phpversion();						$subject = $wl_rcsm_options['page_meta_title'].': Confirmation Subscription';			$message = 'Hi '.$f_name.' '.$l_name.', <br/>';			//$message .= 'Thanks for Subscribing! Click the link below to get confirmed:<a href="'.$plugin_url.'?act_code='.$act_code.'&'.'email='.$visitor_email.'">Confirm</a>';				global $current_user;				wp_get_current_user();				$plugin_site_url = site_url();  				$message .= '<p>Thanks for subscribing!</p><br><p>Click the link below to get confirmed.<br><a href="'.$plugin_site_url.'?act_code='.$act_code.'&'.'email='.$visitor_email.'#newsletter">Confirm Subscriptions</a></p><br><p>Regards</p><p><a href="'.$plugin_site_url.'">'.$wl_rcsm_options['page_meta_title'].'</a></p>';				$mail= wp_mail( $visitor_email, $subject, $message, $headers);			if($mail){				$_SESSION['mail_sent_msg'] = $wl_rcsm_options['sub_form_subscribe_seuccess_message'];				global $wpdb;				$table_name = $wpdb->prefix . 'rcsm_subscribers';				$query= $wpdb->insert( $table_name, array( 'email' => $visitor_email ,'f_name' => $f_name ,'l_name' => $l_name , 'date' => $current_time, 'act_code' => $act_code, 'flag' => 0 ) );			} else {				$_SESSION['subscribe_msg'] = $wl_rcsm_options['sub_form_subscribe_invalid_message'];			}		} else {			$visitor_email = sanitize_text_field($_POST['subscribe_email']);			$current_time = current_time( 'Y-m-d h:i:s' );			global $wpdb;			$table_name = $wpdb->prefix . 'rcsm_subscribers';			$query= $wpdb->insert( $table_name, array( 'email' => $visitor_email , 'f_name' => $f_name ,'l_name' => $l_name , 'date' => $current_time, 'flag' => 1 ) );			if($query){				$_SESSION['subscribe_msg'] = $wl_rcsm_options['sub_form_subscribe_seuccess_message'];			} else {				$_SESSION['subscribe_msg'] = $wl_rcsm_options['sub_form_subscribe_invalid_message'];			}		}	}}		// add new user subscription via SMTP mail setting ONif(isset($_POST['php_submit_subscriber'])){	global $wpdb;	$table_name = $table_name = $wpdb->prefix . "rcsm_subscribers";	$visitor_email = sanitize_text_field($_POST['subscribe_email']);	//$nonce = $_POST['subscriber_nonce_field'];	$email_check =$wpdb->get_results( "SELECT * FROM $table_name WHERE email = '$visitor_email'" );	$num_email = $wpdb->num_rows;	if($email_check)  {		$_SESSION['subscribe_msg'] = $wl_rcsm_options['sub_form_subscribe_invalid_message'];	} else {		if($wl_rcsm_options['confirm_email_subscribe'] == 'on'){			include 'PHPMailer/PHPMailerAutoload.php';			//Create a new PHPMailer instance			$mail = new PHPMailer;			//Enable SMTP debugging			// 0 = off (for production use)			// 1 = client messages			// 2 = client and server messages			//$mail->SMTPDebug = 2;			//Ask for HTML-friendly debug output			//$mail->Debugoutput = 'html';			$select_process = $wl_rcsm_options['subscribe_select'];			if($select_process == 'smtp_mail') {				//Tell PHPMailer to use SMTP				$mail->isSMTP();				//Set the hostname of the mail server				$host_value = $wl_rcsm_options['smtp_host_address'];				$mail->Host = $host_value;												//Set the SMTP port number - likely to be 25, 465 or 587				$smtp_port = $wl_rcsm_options['smtp_port'];				$mail->Port = $smtp_port;    				//Set the encryption system to use - ssl (deprecated) or tls				$smtp_secure = $wl_rcsm_options['smtp_secure'];  				$mail->SMTPSecure = $smtp_secure;				//Whether to use SMTP authentication				$mail->SMTPAuth = true;												//Username to use for SMTP authentication											$smtp_username = $wl_rcsm_options['smtp_user_name'];				$smtp_user = $wl_rcsm_options['smtp_username'];				$mail->Username = $smtp_user;				//Password to use for SMTP authentication				$smtp_password = $wl_rcsm_options['smtp_password']; 				$mail->Password = $smtp_password;				//Set who the message is to be sent from				$mail->setFrom($smtp_user,$smtp_username);				//Set an alternative reply-to address				$mail->addReplyTo($smtp_user,$smtp_username);				//Set who the message is to be sent to				$current_time = current_time( 'Y-m-d h:i:s' );				$f_name = $_POST['f_name'];				$l_name = $_POST['l_name'];				$messagebody = 'Hi '.$f_name.' '.$l_name.', <br/>';				$recived_email = $_POST['subscribe_email'];				$mail->addAddress($recived_email,$recived_email);				//Set the subject line				$mailsubject = $wl_rcsm_options['page_meta_title'].': Confirmation Subscription';				$mail->Subject = $mailsubject;											//Read an HTML message body from an external file, convert referenced images to embedded,				//convert HTML into a basic plain-text alternative body				//$mail->msgHTML(file_get_contents('contents.html'), dirname(__FILE__));				//Replace the plain text body with one created manually								$php_act_code = rand(0,10000);				global $current_user;				wp_get_current_user();				$plugin_site_url = site_url();  				$messagebody .= '<p>Thanks for subscribing!</p><br><p>Click the link below to get confirmed.<br><a href="'.$plugin_site_url.'?act_code='.$php_act_code.'&'.'email='.$recived_email.'#newsletter">Confirm Subscriptions</a></p><br><p>Regards</p><p>'.$current_user->user_name.'</p><p><a href="'.$plugin_site_url.'">'.$wl_rcsm_options['page_meta_title'].'</a></p>';				$mail->Body    = $messagebody;				$mail->AltBody = $messagebody;											}			if(!$mail->send()) {				$_SESSION['subscribe_msg']= $wl_rcsm_options['sub_form_subscribe_invalid_message']; 				$_SESSION['subscribe_msg'] = "Subscriber From SMTP setting not configure properly. Please contact to administrator.";				$_SESSION['subscribe_msg'] .= '<p>Mailer Error: ' . $mail->ErrorInfo."</p>";			} else {				$_SESSION['subscribe_msg']= $wl_rcsm_options['sub_form_subscribe_seuccess_message'];				global $wpdb;				$table_name = $wpdb->prefix . 'rcsm_subscribers';				$query= $wpdb->insert( $table_name, array( 'email' => $recived_email ,'f_name' => $f_name ,'l_name' => $l_name , 'date' => $current_time, 'act_code' => $php_act_code, 'flag' => 0 ) );			}		} else {			$visitor_email = sanitize_text_field($_POST['subscribe_email']);			$current_time = current_time( 'Y-m-d h:i:s' );			global $wpdb;			$table_name = $wpdb->prefix . 'rcsm_subscribers';			$query= $wpdb->insert( $table_name, array( 'email' => $visitor_email ,'f_name' => $f_name ,'l_name' => $l_name , 'date' => $current_time, 'flag' => 1 ) );			if($query){				$_SESSION['subscribe_msg'] = $wl_rcsm_options['sub_form_subscribe_seuccess_message'];			} else {				$_SESSION['subscribe_msg'] = $wl_rcsm_options['sub_form_subscribe_invalid_message'];			}		}	}}?>