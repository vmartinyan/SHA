!function(a,b){function c(a){var b=this,c={autoplay:!0,erase:!0};b.events={},b.scene=-1,b.scenario=[],b.options=b.utils.merge(c,a||{}),b.casting={},b.current={},b.state="ready"}c.prototype={constructor:c,set:function(a,b){var c=this;switch(c.current.model=a,c.current.type){case"function":c.current.voice.apply(c,b);break;default:c.current.voice.innerHTML=a}return c},getSayingSpeed:function(a,b){"number"!=typeof a&&(b=a,a=0);var c=this,d=c.current.experience+a,e=b?d:c.utils.randomFloat(d,1);return c.utils.getPercentageBetween(1e3,50,e)},getInvincibility:function(){var a=this;return 10*a.current.experience},isMistaking:function(){var a=this;return a.current.experience<a.utils.randomFloat(0,1.4)},utils:{merge:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},getPercentageBetween:function(a,b,c){return a-a*c+b*c},randomCharNear:function(a){var g,h,b=this,c={z:[0,0],x:[1,0],c:[2,0],v:[3,0],b:[4,0],n:[5,0],m:[6,0],",":[7,0],".":[8,0],"/":[9,0],a:[0,1],s:[1,1],d:[2,1],f:[3,1],g:[4,1],h:[5,1],j:[6,1],k:[7,1],l:[8,1],";":[9,1],"'":[10,1],q:[0,2],w:[1,2],e:[2,2],r:[3,2],t:[4,2],y:[5,2],u:[6,2],i:[7,2],o:[8,2],p:[9,2],"[":[10,2],"]":[11,2],"\\":[12,2]},d=1,e=[],f=c[a];if(f instanceof Array)for(g in c)c.hasOwnProperty(g)&&(h=c[g],Math.abs(f[0]-h[0])<=d&&Math.abs(f[1]-h[1])<=d&&e.push(g));return e.length>0?e[b.randomNumber(0,e.length-1)]:b.randomChar()},randomChar:function(){var a=this,b="abcdefghijklmnopqrstuvwxyz";return b.charAt(a.randomNumber(0,b.length-1))},randomNumber:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},randomFloat:function(a,b){return Math.round(10*(Math.random()*(b-a)+a))/10},hasClass:function(a,b){return a.classList?a.classList.contains(b):new RegExp("(^| )"+b+"( |$)","gi").test(a.className)},addClass:function(a,b){a.classList?a.classList.add(b):a.className+=" "+b},removeClass:function(a,b){a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ")}},train:function(a){var b=this,c={experience:.6,voice:function(a){console.log(a)},type:"function",model:""};return b.utils.merge(c,a)},describe:function(a,c,d){if("string"!=typeof a)throw"actor's name has wrong type: "+typeof a;var e=this,f={name:a};return void 0!==c&&(f.experience=c),void 0!==d&&(f.type="function"==typeof d?"function":"DOM",f.voice="DOM"===f.type?"string"==typeof d?b.querySelector(d):d:d),e.casting[a]=e.train(f),e},write:function(){for(var c,a=this,b=Array.prototype.splice.apply(arguments,[0]),d=0,e=b.length;e>d;d++)if(c=b[d],"string"==typeof c){var f=c.split(":"),g=f.length>1,h=g?f[0].trim():null,i=g?f[1]:f[0];g&&a.write({name:"actor",args:[h]}),a.options.erase&&g&&a.write({name:"erase"}),a.write({name:"say",args:[i,!g]})}else"number"==typeof c?0>c?a.write({name:"erase",args:[c]}):a.write({name:"wait",args:[c]}):"function"==typeof c?a.write({name:"call",args:[c]}):c instanceof Object&&a.scenario.push(c);return a.options.autoplay&&a.play(),a},play:function(a){var b=this;return a===!0&&(b.scene=-1),"ready"===b.state&&b.next(),b},on:function(a,b){var c=this;a=a.split(",");for(var f,d=0,e=a.length;e>d;d++)f=a[d]=a[d].trim(),(c.events[f]||(c.events[f]=[])).push(b);return c},emit:function(a,b,c){if("string"!=typeof a)throw"emit: scope missing";"string"!=typeof b?b=void 0:void 0!==b&&void 0===c&&(c=b);var d=this,e=a+(b?":"+b:"");return d.trigger(e,c).trigger("*",[e].concat(c)),d},trigger:function(a,b){var c=this,d=c.events[a]||[];b instanceof Array||(b=[b]);for(var e=0,f=d.length;f>e;e++)d[e].apply(c,[a].concat(b));return c},call:function(a,b){var c=this;return a.apply(c),b?c:c.next()},next:function(){var a=this,b=a.scenario[a.scene];if(b&&a.emit(b.name,"end",[b.name].concat(b.args)),a.scene+1>=a.scenario.length)a.state="ready";else{a.state="playing";var c=a.scenario[++a.scene];a.emit(c.name,"start",[c.name].concat(c.args)),a[c.name].apply(a,c.args)}return a},actor:function(a){var b=this;return b.current=b.casting[a],b.next()},say:function(a,b){var f,g,c=this,d=!1,e=c.getInvincibility();b?(g=c.current.model,f=c.current.model.length-1,a=g+a):(g=c.current.model="",f=-1);var h=setTimeout(function i(){var j,k,b=g.charAt(f);d?(e=c.getInvincibility(),d=!1,j=null,k=g=g.substr(0,f),f--):(f++,j=--e<0&&c.isMistaking()?c.utils.randomCharNear(b):a.charAt(f),j!==a.charAt(f)&&(d=!0),k=g+=j),c.set(k,[k,j,b,a]),d||f<a.length?h=setTimeout(i,c.getSayingSpeed()):c.next()},c.getSayingSpeed());return c},erase:function(a){var b=this,c="string"==typeof b.current.model?b.current.model.length:-1,d="number"==typeof a&&0>a?c+1+a:0;return 0>c?b.next():(setTimeout(function f(){var a=b.current.model.charAt(c),e=b.current.model.substr(0,--c);b.set(e,[e,null,a,e]),c>=d?setTimeout(f,b.getSayingSpeed(.2,!0)):b.next()},b.getSayingSpeed(.2,!0)),b)},wait:function(a){var b=this;return setTimeout(function(){b.next()},a),b}},a.TheaterJS=c}(window,document);